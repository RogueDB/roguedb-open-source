/* 
 * Copyright (C) Rogue LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited.
 * Written by Jacob Bartholomew Blankenship [jacob.blankenship@roguedb.com] - January 2022
 */

syntax = "proto3";

import "google/protobuf/any.proto";

package rogue.services;

message Credentials
{
    string identifier = 1; // index-1
    string api_key = 2; // index-2
}

message Update
{
    Credentials credentials = 1;
    repeated google.protobuf.Any messages = 2;
}

message Remove
{
    Credentials credentials = 1;
    repeated google.protobuf.Any messages = 2;
}

message Insert
{
    Credentials credentials = 1;
    repeated google.protobuf.Any messages = 2;
}

message Messages
{
    repeated google.protobuf.Any messages = 1;
}

message Response
{
    map<uint64, Messages> results = 1;
}

enum LogicalOperator
{
    AND = 0;
    OR = 1;
}
enum ComparisonOperator
{
    COMPARISON_OPERATOR_UNKNOWN = 0;
    EQUAL = 1;
    NOT_EQUAL = 2;
    LESSER = 3;
    LESSER_EQUAL = 4;
    GREATER = 5;
    GREATER_EQUAL = 6;
}

message Basic
{
    LogicalOperator logical_operator = 1;
    repeated ComparisonOperator comparisons = 2;
    repeated google.protobuf.Any operands = 3;
    repeated int32 fields = 4; // Future feature.
}

// NOTE: Future feature
message Complex
{
    repeated LogicalOperator logical_operators = 1;
    repeated Expression expressions = 2;
}

message Expression
{
    oneof expression
    {
        Basic basic = 1;
        Complex complex = 2;
    }
}

// Intended for sequencing the following: 
// - Queries with different message types,
// - Server side operations
// - Combining queries with server side operations
message Query
{
    oneof task
    {
        Mapping mapping = 1;
        Basic basic = 2;
        Complex complex = 3;
        Compositional compositional = 4;
        // Future server side operations...
    }
}

// NOTE: Future feature
message Mapping
{
    string identifier = 1;
    repeated uint32 input_fields = 2;
    repeated uint32 output_fields = 3;
    Query task = 4;
}

// NOTE: Future feature
message Compositional
{
    Query initial = 1;
    repeated Mapping mappings = 2;
}

message Search
{
    Credentials credentials = 1;
    repeated Query queries = 2;
}

enum Source
{
    UNCOMPATIBLE = 0;
    PROTO = 1;
    JSON = 2; // NOTE: Future feature
    CSV = 3; // NOTE: Future feature
}

message Schema
{
    Source source = 1;
    string filename = 2;
    string contents = 3;
}

message Subscribe
{
    Credentials credentials = 1;
    repeated Schema schemas = 2;
}
